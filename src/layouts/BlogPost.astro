---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  heroImage?: string;
  heroImageAlt?: string;
  category?: string;
  tags?: string[];
  readingTime?: number;
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  heroImageAlt = '',
  category,
  tags = [],
  readingTime,
} = Astro.props;

const formattedDate = pubDate.toLocaleDateString('pl-PL', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const formattedUpdated = updatedDate?.toLocaleDateString('pl-PL', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const articleSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "datePublished": pubDate.toISOString(),
  "dateModified": (updatedDate || pubDate).toISOString(),
  "author": {
    "@type": "Person",
    "name": "Karol Leszczyński",
    "url": "https://www.copywriting-blog.pl/o-mnie/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Copywriting BLOG",
    "url": "https://www.copywriting-blog.pl"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url.href
  },
  ...(heroImage ? { "image": new URL(heroImage, Astro.site).href } : {}),
  ...(tags.length ? { "keywords": tags.join(', ') } : {})
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Start",
      "item": Astro.site?.href
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": `${Astro.site?.href}blog/`
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": title
    }
  ]
};
---

<BaseLayout
  title={title}
  description={description}
  image={heroImage}
  article={true}
  publishedTime={pubDate.toISOString()}
  modifiedTime={(updatedDate || pubDate).toISOString()}
>
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <div class="container">
    <nav class="breadcrumbs" aria-label="Breadcrumbs">
      <a href="/">Start</a>
      <span class="separator">›</span>
      <a href="/blog/">Blog</a>
      <span class="separator">›</span>
      <span>{title}</span>
    </nav>
  </div>

  <article>
    <header class="post-header">
      {category && <span class="post-category">{category}</span>}
      <h1>{title}</h1>
      <div class="post-meta">
        <span>Karol Leszczyński</span>
        <span class="separator"></span>
        <time datetime={pubDate.toISOString()}>{formattedDate}</time>
        {readingTime && (
          <>
            <span class="separator"></span>
            <span>{readingTime} min czytania</span>
          </>
        )}
      </div>
      {updatedDate && (
        <p style="font-size: var(--text-xs); color: var(--color-ink-faint); margin-top: var(--space-md);">
          Zaktualizowano: <time datetime={updatedDate.toISOString()}>{formattedUpdated}</time>
        </p>
      )}
    </header>

    {heroImage && (
      <div class="post-hero-image">
        <img src={heroImage} alt={heroImageAlt} width="896" height="504" loading="eager" />
      </div>
    )}

    <div class="post-content">
      <slot />
    </div>

    {tags.length > 0 && (
      <div class="content-narrow" style="padding-bottom: var(--space-3xl);">
        <div style="display: flex; flex-wrap: wrap; gap: var(--space-sm);">
          {tags.map(tag => (
            <span class="tag">{tag}</span>
          ))}
        </div>
      </div>
    )}
  </article>
</BaseLayout>